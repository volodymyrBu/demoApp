<!doctype html>
<html lang="en"
      style="height: 100%;">

<head>
    <meta charset="utf-8">
    <title>Bread</title>
    <base href="/">
    <meta name="viewport"
          content="width=device-width, initial-scale=1">
    <style>
        .btn:active {
            transform: scale(0.98);
            /* Scaling button to 0.98 to its original size */
            box-shadow: 3px 2px 22px 1px rgba(0, 0, 0, 0.24);
            /* Lowering the shadow */
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #6e6e73;
            width: 25px;
            height: 25px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
            position: absolute;
            left: 0;
            top: 40%;
            right: 0;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }

        .lallemand {
            margin-top: 10px;
        }

        /* Safari */
        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body
      style="height: 100%;margin: 0;background-color:#eeeeee4f;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
    <div style="display: flex;
    justify-content: center;
    flex-direction: column;
    height: 100%;
    align-items: center;">
        <svg viewBox="12 15 220.7 140"
             fill="none"
             width="120"
             height="120"
             class="lallemand"
             title="Lallemand Bio Ingredients"
             xmlns="http://www.w3.org/2000/svg">
            <g>
                <ellipse fill="#EF3E42"
                         stroke="#EF3E42"
                         cx="122.8"
                         cy="57"
                         rx="109.9"
                         ry="40.4" />
            </g>
            <g>
                <path fill="#FFFFFF"
                      d="M36.2,64.5h7.2l-0.8,6.2H29.4L33,42.4h6L36.2,64.5z" />
                <path fill="#FFFFFF"
                      d="M51.9,65.8l-2.2,4.9h-6.4l12.6-28.3h6.6l5.1,28.3h-6.4l-0.9-4.9H51.9z M58.1,51.1L58.1,51.1l-3.7,9h5 L58.1,51.1z" />
                <path fill="#FFFFFF"
                      d="M76.8,64.5H84l-0.8,6.2H69.9l3.7-28.3h6L76.8,64.5z" />
                <path fill="#FFFFFF"
                      d="M92.5,64.5h7.2l-0.8,6.2H85.6l3.7-28.3h6L92.5,64.5z" />
                <path fill="#FFFFFF"
                      d="M110,48.6l-0.6,4.7h6.8l-0.8,6.2h-6.8l-0.6,4.9h7.2l-0.8,6.2H101l3.7-28.3h13.2l-0.8,6.2H110z" />
                <path fill="#FFFFFF"
                      d="M124.1,42.4h5.9l2.7,15.1l7-15.1h6l-0.2,28.3h-6l0.4-16.3h-0.1l-7.7,16.3h-2.4l-3.2-16.3h-0.1l-4.1,16.3h-6 L124.1,42.4z" />
                <path fill="#FFFFFF"
                      d="M154.8,65.8l-2.2,4.9h-6.4l12.6-28.3h6.6l5.1,28.3H164l-0.9-4.9H154.8z M161,51.1L161,51.1l-3.7,9h5 L161,51.1z" />
                <path fill="#FFFFFF"
                      d="M176.2,42.4h6l8.8,17.3h0.1l2.3-17.3h6l-3.7,28.3h-6l-8.8-17.4h-0.1l-2.3,17.4h-6L176.2,42.4z" />
                <path fill="#FFFFFF"
                      d="M202.6,42.4h8.6c6.5,0,11,6.2,10,14.2c-1,8-7.2,14.2-13.6,14.2h-8.6L202.6,42.4z M205.8,64.5h1.4 c3.6,0,7-2.4,7.7-7.9c0.7-5.1-1.7-7.9-5.6-7.9h-1.4L205.8,64.5z" />
            </g>
            <text x="18"
                  y="124"
                  class="svgtext"
                  stroke-width="0">LALLEMAND BIO-INGREDIENTS</text>
        </svg>
        <div style="display: flex;justify-content: space-between;
        align-items: center;height: 100%;margin-bottom: 15px;flex-direction: column;">

            <div style="display:flex;padding-top: 40px;justify-content: center;flex-direction: column;
            align-items: center;">
                <p id="labels"
                   style="display: none;font-size: 14px;"></p>
                <img style="
                            height: 35vh;
                            width: 35vh;
                            border-radius:4px;
                            transition: all 0.1s ease-out;
                            box-shadow: 0px 35px 77px -17px rgb(0 0 0 / 44%);"
                     id="analyzedImage"
                     alt="analyzed image"
                     hidden />
            </div>
            <div style="
                    margin-bottom: 10px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;">
                <p style="
                    font-size: 12px;
                    color: #6c757d;
                    ">
                    Select photo to start
                </p>
                <input type="file"
                       id="upload"
                       accept="image/*"
                       hidden />

                <label class="btn"
                       style="
                        display: inline-block;
                        background-color: white;
                        padding: 0.8rem;
                        font-family: sans-serif;
                        border-radius: 50%;
                        cursor: pointer;
                        border: 2px solid #6e6e73;"
                       for="upload">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="30"
                         height="30"
                         fill="#6e6e73"
                         viewBox="0 0 16 16">
                        <path
                              d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z" />
                        <path
                              d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z" />
                    </svg></label>
            </div>

        </div>
    </div>
    <div class="loader"
         id="loader">
    </div>


    <script>
        const uploadElement = document.getElementById("upload");
        uploadElement.addEventListener('change', handleUploadFile);
        const loader = document.getElementById('loader');
        const image = document.getElementById('analyzedImage');
        const labels = document.getElementById('labels');


        function handleUploadFile(event) {
            var file = event.target.files[0];
            if (file)
                sendFile(file);
        }

        async function sendFile(file) {
            loader.style.display = 'block';
            labels.style.display = 'none';
            uploadElement.disabled = true;
            image.hidden = true;
            const apiUrl = 'https://func-lallemand-demo.azurewebsites.net/imgsegmentation?code=qLyE26WZHuNenVZMSyg7OpWZs7SI7YmuO3I_cYGVK0aVAzFufuik2A==';
            var formData = new FormData();
            formData.append('file', file);

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {},
                body: formData
            })

            if (!response.ok) {
                labels.textContent = `Something went wrong`;
                labels.style.display = 'inline';
                loader.style.display = 'none';
                uploadElement.disabled = false;
            }
            else {
                response.json()
                    .then(
                        response => {
                            if (response.uri) {
                                image.hidden = false;
                                image.src = response.uri;
                                labels.textContent = `Label1 ${response.label1}%   Label2 ${response.label2}%`;
                                labels.style.display = 'inline';
                            }
                            uploadElement.disabled = false;
                            loader.style.display = 'none';
                        }
                    )
                    .catch(error => {
                        labels.textContent = `Something went wrong`;
                        labels.style.display = 'inline';
                        loader.style.display = 'none';
                        uploadElement.disabled = false;
                        console.log(error);
                    });
            }

        }

    </script>
</body>

</html>